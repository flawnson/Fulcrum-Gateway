{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useOption = useOption;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _collections = require(\"@react-stately/collections\");\n\nvar _utils = require(\"./utils\");\n\nvar _interactions = require(\"@react-aria/interactions\");\n\nvar _interactions2 = require(\"@react-native-aria/interactions\");\n\nvar _utils2 = require(\"@react-aria/utils\");\n\nvar _selection = require(\"@react-aria/selection\");\n\nvar _utils3 = require(\"@react-native-aria/utils\");\n\nfunction useOption(props, state, ref) {\n  var isSelected = props.isSelected,\n      isDisabled = props.isDisabled,\n      key = props.key,\n      shouldSelectOnPressUp = props.shouldSelectOnPressUp,\n      shouldFocusOnHover = props.shouldFocusOnHover,\n      isVirtualized = props.isVirtualized,\n      shouldUseVirtualFocus = props.shouldUseVirtualFocus;\n  var labelId = (0, _utils2.useSlotId)();\n  var descriptionId = (0, _utils2.useSlotId)();\n  var _optionProps = {\n    'role': 'option',\n    'aria-disabled': isDisabled,\n    'aria-selected': isSelected\n  };\n\n  if (!((0, _utils2.isMac)() && (0, _utils2.isWebKit)())) {\n    _optionProps['aria-label'] = props['aria-label'];\n    _optionProps['aria-labelledby'] = labelId;\n    _optionProps['aria-describedby'] = descriptionId;\n  }\n\n  if (isVirtualized) {\n    _optionProps['aria-posinset'] = state.collection.getItem(key).index + 1;\n    _optionProps['aria-setsize'] = (0, _collections.getItemCount)(state.collection);\n  }\n\n  var _useSelectableItem = (0, _selection.useSelectableItem)({\n    selectionManager: state.selectionManager,\n    key: key,\n    ref: ref,\n    shouldSelectOnPressUp: shouldSelectOnPressUp,\n    isVirtualized: isVirtualized,\n    shouldUseVirtualFocus: shouldUseVirtualFocus\n  }),\n      itemProps = _useSelectableItem.itemProps;\n\n  var _usePress = (0, _interactions2.usePress)((0, _extends2.default)({}, itemProps, {\n    isDisabled: isDisabled,\n    preventFocusOnPress: shouldUseVirtualFocus\n  })),\n      pressProps = _usePress.pressProps;\n\n  var _useHover = (0, _interactions2.useHover)({\n    isDisabled: isDisabled || !shouldFocusOnHover,\n    onHoverStart: function onHoverStart() {\n      if (!(0, _interactions.isFocusVisible)()) {\n        state.selectionManager.setFocused(true);\n        state.selectionManager.setFocusedKey(key);\n      }\n    }\n  }, ref),\n      hoverProps = _useHover.hoverProps;\n\n  var onMouseDown = function onMouseDown(e) {\n    return e.stopPropagation();\n  };\n\n  _optionProps = (0, _extends2.default)({}, _optionProps, (0, _utils2.mergeProps)(pressProps, hoverProps), {\n    id: (0, _utils.getItemId)(state, key),\n    onMouseDown: onMouseDown\n  });\n  var optionProps = (0, _utils3.useMapDomPropsToRN)(_optionProps, ref);\n  return {\n    optionProps: optionProps,\n    labelProps: {\n      nativeID: labelId\n    },\n    descriptionProps: {\n      nativeID: descriptionId\n    }\n  };\n}","map":{"version":3,"sources":["useOption.web.ts"],"names":["shouldUseVirtualFocus","labelId","descriptionId","_optionProps","isSelected","isMac","props","state","getItemCount","itemProps","useSelectableItem","selectionManager","key","ref","shouldSelectOnPressUp","isVirtualized","pressProps","usePress","isDisabled","preventFocusOnPress","hoverProps","useHover","onHoverStart","onMouseDown","e","mergeProps","id","getItemId","optionProps","useMapDomPropsToRN","labelProps","nativeID","descriptionProps"],"mappings":"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","sourcesContent":["import { getItemCount } from '@react-stately/collections';\nimport { getItemId } from './utils';\nimport { Key, RefObject } from 'react';\nimport { isFocusVisible } from '@react-aria/interactions';\nimport { useHover, usePress } from '@react-native-aria/interactions';\nimport { isMac, isWebKit, mergeProps, useSlotId } from '@react-aria/utils';\nimport { ListState } from '@react-stately/list';\nimport { useSelectableItem } from '@react-aria/selection';\nimport { useMapDomPropsToRN } from '@react-native-aria/utils';\n\ninterface OptionAria {\n  /** Props for the option element. */\n  optionProps: any;\n\n  /** Props for the main text element inside the option. */\n  labelProps: any;\n\n  /** Props for the description text element inside the option, if any. */\n  descriptionProps: any;\n}\n\ninterface AriaOptionProps {\n  /** Whether the option is disabled. */\n  'isDisabled'?: boolean;\n\n  /** Whether the option is selected. */\n  'isSelected'?: boolean;\n\n  /** A screen reader only label for the option. */\n  'aria-label'?: string;\n\n  /** The unique key for the option. */\n  'key'?: Key;\n\n  /** Whether selection should occur on press up instead of press down. */\n  'shouldSelectOnPressUp'?: boolean;\n\n  /** Whether the option should be focused when the user hovers over it. */\n  'shouldFocusOnHover'?: boolean;\n\n  /** Whether the option is contained in a virtual scrolling listbox. */\n  'isVirtualized'?: boolean;\n\n  /** Whether the option should use virtual focus instead of being focused directly. */\n  'shouldUseVirtualFocus'?: boolean;\n}\n\n/**\n * Provides the behavior and accessibility implementation for an option in a listbox.\n * See `useListBox` for more details about listboxes.\n * @param props - Props for the option.\n * @param state - State for the listbox, as returned by `useListState`.\n */\nexport function useOption<T>(\n  props: AriaOptionProps,\n  state: ListState<T>,\n  ref: RefObject<HTMLElement>\n): OptionAria {\n  let {\n    isSelected,\n    isDisabled,\n    key,\n    shouldSelectOnPressUp,\n    shouldFocusOnHover,\n    isVirtualized,\n    shouldUseVirtualFocus,\n  } = props;\n\n  let labelId = useSlotId();\n  let descriptionId = useSlotId();\n\n  let _optionProps: any = {\n    'role': 'option',\n    'aria-disabled': isDisabled,\n    'aria-selected': isSelected,\n  };\n\n  // Safari with VoiceOver on macOS misreads options with aria-labelledby or aria-label as simply \"text\".\n  // We should not map slots to the label and description on Safari and instead just have VoiceOver read the textContent.\n  // https://bugs.webkit.org/show_bug.cgi?id=209279\n  if (!(isMac() && isWebKit())) {\n    _optionProps['aria-label'] = props['aria-label'];\n    _optionProps['aria-labelledby'] = labelId;\n    _optionProps['aria-describedby'] = descriptionId;\n  }\n\n  if (isVirtualized) {\n    //@ts-ignore\n    _optionProps['aria-posinset'] = state.collection.getItem(key).index + 1;\n    _optionProps['aria-setsize'] = getItemCount(state.collection);\n  }\n\n  let { itemProps } = useSelectableItem({\n    selectionManager: state.selectionManager,\n    //@ts-ignore\n    key,\n    ref,\n    shouldSelectOnPressUp,\n    isVirtualized,\n    shouldUseVirtualFocus,\n  });\n\n  let { pressProps } = usePress({\n    ...itemProps,\n    isDisabled,\n    preventFocusOnPress: shouldUseVirtualFocus,\n  });\n\n  let { hoverProps } = useHover(\n    {\n      isDisabled: isDisabled || !shouldFocusOnHover,\n      onHoverStart() {\n        if (!isFocusVisible()) {\n          state.selectionManager.setFocused(true);\n          //@ts-ignore\n          state.selectionManager.setFocusedKey(key);\n        }\n      },\n    },\n    ref\n  );\n\n  // Putting this as a last resort, after several hours of debugging.\n  // Why?\n  // tabListProps adds onMouseDown with preventDefault in useSelectableCollection.ts (React Aria) and react-native-web uses onClick for onPress.\n  // This results in tab button not getting focused when clicked\n  // See this example - https://codesandbox.io/s/issue-i-know-but-dont-know-why-1-ydyw5?file=/src/App.js\n  const onMouseDown = (e: any) => e.stopPropagation();\n\n  _optionProps = {\n    ..._optionProps,\n    ...mergeProps(pressProps, hoverProps),\n    //@ts-ignore\n    id: getItemId(state, key),\n    onMouseDown,\n  };\n\n  const optionProps = useMapDomPropsToRN(_optionProps, ref);\n\n  return {\n    optionProps,\n    labelProps: {\n      nativeID: labelId,\n    },\n    descriptionProps: {\n      nativeID: descriptionId,\n    },\n  };\n}\n"]},"metadata":{},"sourceType":"script"}